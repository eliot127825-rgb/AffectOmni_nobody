#!/bin/bash
# 批量运行所有消融实验

echo "=========================================="
echo "🔬 批量消融实验：λp 和 λt 敏感性分析"
echo "=========================================="

cd ./src

# 定义实验配置 (λp, λt)
# 格式: "λp λt"
EXPERIMENTS=(
    # 基线
    "0.2 0.2"
    
    # λp 敏感性分析 (固定 λt=0.2)
    "0.0 0.2"
    "0.1 0.2"
    "0.3 0.2"
    "0.4 0.2"
    
    # λt 敏感性分析 (固定 λp=0.2)
    "0.2 0.0"
    "0.2 0.1"
    "0.2 0.3"
    "0.2 0.4"
    
    # 联合变化
    "0.1 0.1"
    "0.3 0.3"
    "0.1 0.3"
    "0.3 0.1"
)

echo "总共 ${#EXPERIMENTS[@]} 个实验"
echo ""

# 运行每个实验
for i in "${!EXPERIMENTS[@]}"; do
    exp="${EXPERIMENTS[$i]}"
    read -r lp lt <<< "$exp"
    
    echo "=========================================="
    echo "[$((i+1))/${#EXPERIMENTS[@]}] 运行实验: λp=$lp, λt=$lt"
    echo "=========================================="
    
    bash run_scripts/ablation_reward_weights.sh $lp $lt
    
    if [ $? -ne 0 ]; then
        echo "❌ 实验 λp=$lp, λt=$lt 失败！"
        # 可选: 继续下一个实验还是停止
        # exit 1  # 取消注释以在失败时停止
    fi
    
    echo ""
    echo "⏳ 等待 30 秒后开始下一个实验..."
    sleep 30
done

echo ""
echo "=========================================="
echo "🎉 所有消融实验完成！"
echo "=========================================="
